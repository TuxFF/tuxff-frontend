<!DOCTYPE html>

<html>
  <head>
    <title>Underdog ADP</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-crosshair"></script>

    <style>
      .chart-container {
        height: 550px;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <input type="text" id="year" name="year" placeholder="Enter Year">
    <input type="text" id="player_id_1" name="player_id_1">
    <input type="text" id="player_id_2" name="player_id_2">
    <input type="text" id="player_id_3" name="player_id_3">
    <button onclick="searchAndGraphPlayer()">Search Player</button>

    <div class="chart-container">
      <canvas class="chart" id="adp-visualization"></canvas>
    </div>

    <script>
      async function fetchPlayerADP(playerId, year) {
        try {
          const response = await fetch(`https://ms5dlzolh3.execute-api.us-east-2.amazonaws.com/default/player-get-adp/${year}/${playerId}`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          console.log('API Reponse:', data);
          document.body.innerHTML += '<p>API Response: ' + JSON.stringify(data) + '</p>';
          return data;
        } catch (error) {
          console.error('Error:', error);
          document.body.innerHTML += '<p>Error: ' + error.message + '</p>';
          return null;
        }
      }

      function graphADP(datasets, dates) {
        const ctx = document.getElementById('adp-visualization').getContext('2d');

        const chartConfig = {
          type: 'line',
          data: {
            labels: dates,
            datasets: datasets
          },
          options: {
            scales: {
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  maxTicksLimit: 8,
                  color: '#333333',
                  font: {
                    size: 15
                  },
                  callback: function(value, index, ticks) {
                    const date = new Date(this.getLabelForValue(value));
                    return `${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
                  }
                }
              },
              y: {
                reverse: true,
                title: {
                  display: true,
                  text: 'Average Draft Pick (ADP)',
                  font: {
                    size: 16,
                    weight: 'bold'
                  },
                  color: '#333333'
                },
                ticks: {
                  maxTicksLimit: 10,
                  color: '#333333',
                  font: {
                    size: 15
                  }
                }
              }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
              },
            interaction: {
              intersect: false,
              mode: 'index'
            },
            plugins: {
              crosshair: {
                line: {
                  color: '#CCCCCC',
                  width: 1
                }
              },
              tooltip: {
                displayColors: false,
                caretPadding: 10,
                backgroundColor: 'white',
                borderColor: '#999999',
                borderWidth: 1,
                titleColor: '#333333',
                bodyColor: '#2222222',
                padding: 12,
                caretSize: 8,
                cornerRadius: 6,
                bodySpacing: 4,
                titleSpacing: 4,
                titleFont: {
                  size: 14
                },
                bodyFont: {
                  size: 13
                },
                callbacks: {
                  title: function(context) {
                    const date = new Date(context[0].label);
                    return `${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}/${date.getFullYear()}`;
                  },
                  label: function(context) {
                    return `● ${context.dataset.label}: ${context.parsed.y}`;
                  }
                }
              },
              legend: {
                position: 'bottom',
                labels: {
                  font: {
                    size: 14
                  },
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'line'
                }
              },
            }
          }
        }

        new Chart(ctx, chartConfig);
      }

      async function searchAndGraphPlayer() {
        const year = document.getElementById('year').value;
        const playerId_1 = document.getElementById('player_id_1').value;
        const playerId_2 = document.getElementById('player_id_2').value;
        const playerId_3 = document.getElementById('player_id_3').value;

        const data_1 = await fetchPlayerADP(playerId_1, year);
        const data_2 = await fetchPlayerADP(playerId_2, year);
        const data_3 = await fetchPlayerADP(playerId_3, year);
        
        const dataArray = [data_1, data_2, data_3].filter(data => data !== null);

        if (dataArray.length > 0) {
          const lineData = [];
          let dates = []

          for (const i in dataArray) {
            const data = dataArray[i]; 
            const adpData = data[3];
            dates = Object.keys(adpData);
            const adpValues = Object.values(adpData);

            lineData.push({
              label: `${data[1]} (${data[2]})`,
              data: adpValues,
              borderColor: `hsl(${i * 120}, 70%, 50%)`,
              borderWidth: 4,
              tension: 0.15,
              pointRadius: 0,
              pointHoverRadius: 6,
              pointHitRadius: 10  
            })
          }

          graphADP(lineData, dates)
        }
      }

    </script>

  </body>
</html>