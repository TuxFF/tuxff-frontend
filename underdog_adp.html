<!DOCTYPE html>

<html>
  <head>
    <title>Underdog ADP</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      .chart-container {
        height: 500px;
      }
    </style>
  </head>

  <body>
    <input type="text" id="player_id_1" name="player_id_1">
    <input type="text" id="player_id_2" name="player_id_2">
    <input type="text" id="player_id_3" name="player_id_3">
    <button onclick="searchAndGraphPlayer()">Search Player</button>

    <div class="chart-container">
      <canvas id="adp-visualization"></canvas>
    </div>

    <script>
      async function fetchPlayerADP(playerId) {
        try {
          const response = await fetch(`https://ms5dlzolh3.execute-api.us-east-2.amazonaws.com/default/player-get-adp/${playerId}`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          console.log('API Reponse:', data);
          document.body.innerHTML += '<p>API Response: ' + JSON.stringify(data) + '</p>';
          return data;
        } catch (error) {
          console.error('Error:', error);
          document.body.innerHTML += '<p>Error: ' + error.message + '</p>';
          return null;
        }
      }

      function graphADP(datasets, dates) {
        const ctx = document.getElementById('adp-visualization').getContext('2d');

        const chartConfig = {
          type: 'line',
          data: {
            labels: dates,
            datasets: datasets
          }
        }

        new Chart(ctx, chartConfig);
      }

      async function searchAndGraphPlayer() {
        const playerId_1 = document.getElementById('player_id_1').value;
        const playerId_2 = document.getElementById('player_id_2').value;
        const playerId_3 = document.getElementById('player_id_3').value;

        const data_1 = await fetchPlayerADP(playerId_1);
        const data_2 = await fetchPlayerADP(playerId_2);
        const data_3 = await fetchPlayerADP(playerId_3);
        
        const dataArray = [data_1, data_2, data_3].filter(data => data !== null);

        if (dataArray.length > 0) {
          const lineData = [];
          let dates = []

          for (const i in dataArray) {
            const data = dataArray[i]; 
            const adpData = data[3];
            dates = Object.keys(adpData);
            const adpValues = Object.values(adpData);

            lineData.push({
              label: `${data[1]} (${data[2]})`,
              data: adpValues,
              borderColor: `hsl(${i * 120}, 70%, 50%)`,
              tension: 0.1
            })
          }

          graphADP(lineData, dates)
        }
      }

    </script>

  </body>
</html>